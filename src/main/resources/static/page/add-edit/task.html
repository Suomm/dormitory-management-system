<div class="layuimini-main">
	<div class="layui-form layuimini-form" style="margin-left: -90px;">
		<div class="layui-form-item">
			<label class="layui-form-label required">周次：</label>
			<div class="layui-input-block">
				<div id="week" class="layui-form-mid layui-word-aux"></div>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label required">列表：</label>
			<div class="layui-input-block" id="building-list"></div>
		</div>
		<div class="layui-form-item">
			<div class="layui-input-block">
			<button class="layui-btn layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
			</div>
		</div>
	</div>
</div>
<script>
	layui.use('template', function() {
		var $ = layui.$,
			form = layui.form,
			layer = layui.layer,
			template = layui.template;
		// 当前弹出层，防止ID被覆盖
		var parentIndex = layer.index;
		$(document).ready(function () {
			$.get("/dormitory/buildings", function (buildings) {
				var $list = $('#building-list');
				buildings.forEach(function (value) {
					$list.append(`<input type="checkbox" name="buildings" value="${value}" title="${value}">`);
				});
				form.render();
			});
		});
		//监听提交
		form.on('submit(saveBtn)', function(data) {
			var data = data.field;
			var buildings = [];
			$('input[type=checkbox]:checked').each(function() {
				buildings.push($(this).val());
			});
			if (buildings.length === 0) {
				layer.msg('请选择要检查的宿舍楼', {icon: 5, shift: 6});
				return false;
			}
			$.ajax({
				type: 'post',
				url: '/task/save',
				data: JSON.stringify(buildings),
				contentType: "application/json",
				success: function (status) {
					status ? layer.msg("操作成功", {icon: 1}) : layer.msg("操作失败", {icon: 5, shift: 6});
					parent.reloadTable();
					layer.close(parentIndex);
				}
			});
			return false;
		});
	});
</script>
